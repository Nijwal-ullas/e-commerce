<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - RnBB Collection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }
      .submenu.open {
        max-height: 200px;
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
      <%- include('../partials/admin/sidebar') %>

      <div class="flex-1 overflow-auto">
        <%- include('../partials/admin/header') %>

        <div class="p-6">
          <!-- Welcome Banner -->
          <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-8 text-white mb-6">
            <div class="flex justify-between items-center">
              <div>
                <h1 class="text-3xl font-bold mb-2">
                  Welcome back, <%= adminName || 'Admin' %>!
                </h1>
                <p class="text-sm opacity-90 mb-4">
                  Here's your business overview for today
                </p>
                <div class="flex gap-3">
                  <a href="/admin/sales-report" class="bg-white text-indigo-600 font-semibold py-2 px-6 rounded-lg hover:shadow-lg transition inline-flex items-center">
                    <i class="fas fa-file-alt mr-2"></i>Full Report
                  </a>
                  <button onclick="window.print()" class="bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-800 transition inline-flex items-center">
                    <i class="fas fa-print mr-2"></i>Print Dashboard
                  </button>
                </div>
              </div>
              <div class="hidden md:block">
                <i class="fas fa-chart-line text-8xl opacity-20"></i>
              </div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Orders -->
            <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500 mb-1">Sales Count</p>
                  <h2 class="text-3xl font-bold text-gray-800"><%= salesCount || 0 %></h2>
                  <p class="text-xs text-green-600 mt-2">
                    <i class="fas fa-arrow-up mr-1"></i>Active
                  </p>
                </div>
                <div class="bg-indigo-100 rounded-full p-4">
                  <i class="fas fa-shopping-bag text-indigo-600 text-2xl"></i>
                </div>
              </div>
            </div>

            <!-- Total Sales -->
            <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500 mb-1">Total Sales Amount</p>
                  <h2 class="text-3xl font-bold text-gray-800">₹<%= totalSalesAmount?.toFixed(2) || "0.00" %></h2>
                  <p class="text-xs text-green-600 mt-2">
                    <i class="fas fa-arrow-up mr-1"></i>Revenue
                  </p>
                </div>
                <div class="bg-green-100 rounded-full p-4">
                  <i class="fas fa-rupee-sign text-green-600 text-2xl"></i>
                </div>
              </div>
            </div>

            <!-- Product Discount -->
            <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500 mb-1">Product Discount</p>
                  <h2 class="text-3xl font-bold text-orange-600">₹<%= totalDiscount?.toFixed(2) || "0.00" %></h2>
                  <p class="text-xs text-gray-500 mt-2">
                    <i class="fas fa-tag mr-1"></i>Offers
                  </p>
                </div>
                <div class="bg-orange-100 rounded-full p-4">
                  <i class="fas fa-tags text-orange-600 text-2xl"></i>
                </div>
              </div>
            </div>

            <!-- Coupon Discount -->
            <div class="bg-white rounded-xl p-6 shadow-md hover:shadow-lg transition-shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500 mb-1">Coupon Discount</p>
                  <h2 class="text-3xl font-bold text-red-600">₹<%= couponDiscount?.toFixed(2) || "0.00" %></h2>
                  <p class="text-xs text-gray-500 mt-2">
                    <i class="fas fa-ticket-alt mr-1"></i>Coupons
                  </p>
                </div>
                <div class="bg-red-100 rounded-full p-4">
                  <i class="fas fa-ticket-alt text-red-600 text-2xl"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Sales Chart -->
            <div class="bg-white rounded-xl p-6 shadow-md">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Sales Overview</h3>
                <select id="salesFilter" class="text-sm border border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                  <option value="year">This Year</option>
                </select>
              </div>
              <canvas id="salesChart"></canvas>
            </div>

            <!-- Order Status Chart -->
            <div class="bg-white rounded-xl p-6 shadow-md">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">Order Status</h3>
              <canvas id="orderStatusChart"></canvas>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Total Products -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-md">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm opacity-90 mb-1">Total Products</p>
                  <h2 class="text-3xl font-bold"><%= totalProducts || 0 %></h2>
                </div>
                <i class="fas fa-box text-5xl opacity-30"></i>
              </div>
            </div>

            <!-- Total Users -->
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-md">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm opacity-90 mb-1">Total Users</p>
                  <h2 class="text-3xl font-bold"><%= totalUsers || 0 %></h2>
                </div>
                <i class="fas fa-users text-5xl opacity-30"></i>
              </div>
            </div>

            <!-- Active Coupons -->
            <div class="bg-gradient-to-r from-pink-500 to-pink-600 rounded-xl p-6 text-white shadow-md">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm opacity-90 mb-1">Active Coupons</p>
                  <h2 class="text-3xl font-bold"><%= activeCoupons || 0 %></h2>
                </div>
                <i class="fas fa-gift text-5xl opacity-30"></i>
              </div>
            </div>
          </div>

            <!-- Recent Orders -->
            <div class="bg-white rounded-xl p-6 shadow-md">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Recent Orders</h3>
                <a href="/admin/adminOrders" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
                  View All <i class="fas fa-arrow-right ml-1"></i>
                </a>
              </div>
              <div class="space-y-3">
                <% if (recentOrders && recentOrders.length > 0) { %>
                  <% recentOrders.slice(0, 5).forEach(order => { %>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                      <div class="flex items-center gap-3">
                        <div class="bg-indigo-100 rounded-full p-2">
                          <i class="fas fa-receipt text-indigo-600"></i>
                        </div>
                        <div>
                          <p class="font-medium text-gray-800">#<%= order.orderId %></p>
                          <p class="text-xs text-gray-500"><%= order.userName || 'Customer' %></p>
                        </div>
                      </div>
                      <div class="text-right">
                        <p class="font-semibold text-gray-800">₹<%= order.totalAmount?.toFixed(2) %></p>
                        <span class="inline-block px-2 py-1 text-xs rounded-full <%= order.status === 'Delivered' ? 'bg-green-100 text-green-800' : order.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800' %>">
                          <%= order.status %>
                        </span>
                      </div>
                    </div>
                  <% }) %>
                <% } else { %>
                  <p class="text-center text-gray-500 py-8">No recent orders</p>
                <% } %>
              </div>
            </div>

           
          </div>

      </div>
    </div>

    <script>
      function toggleDropdown(subId, chevronId) {
        const sub = document.getElementById(subId);
        const chevron = document.getElementById(chevronId);
        sub.classList.toggle("open");
        chevron.classList.toggle("rotate-180");
      }

      // Sales Chart
      const salesCtx = document.getElementById('salesChart').getContext('2d');
      const salesChart = new Chart(salesCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Sales',
            data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
            borderColor: 'rgb(99, 102, 241)',
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '₹' + value.toLocaleString();
                }
              }
            }
          }
        }
      });

      // Order Status Chart
      const orderCtx = document.getElementById('orderStatusChart').getContext('2d');
      const orderChart = new Chart(orderCtx, {
        type: 'doughnut',
        data: {
          labels: ['Delivered', 'Processing', 'Pending', 'Cancelled'],
          datasets: [{
            data: [45, 25, 20, 10],
            backgroundColor: [
              'rgb(34, 197, 94)',
              'rgb(59, 130, 246)',
              'rgb(251, 191, 36)',
              'rgb(239, 68, 68)'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    </script>
  </body>
</html>