<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BnB Collection  Reset Password</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <%- include('../partials/user/header') %>

  <main class="flex-grow flex items-center justify-center px-4 py-6">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-8 border border-gray-200">
      <h2 class="text-center text-xl font-semibold mb-2">Reset Password</h2>

      <p class="text-center text-sm text-gray-600 mb-6">
        Setting new password for <strong class="text-red-600"><%= email %></strong>
      </p>

      <p id="msg" class="text-center text-sm mb-4"></p>

      <form id="resetForm">
        <div class="mb-4">
          <input id="password" type="password" required placeholder="New Password"
                 class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400"/>
        </div>

        <div class="mb-4">
          <input id="confirmPassword" type="password" required placeholder="Confirm Password"
                 class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:border-gray-400"/>
        </div>

        <button type="submit"
                class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition">
          Reset Password
        </button>
      </form>
    </div>
  </main>

  <%- include("../partials/user/footer") %>

  <script>
    const form = document.getElementById("resetForm");
    const msg  = document.getElementById("msg");

    form.addEventListener("submit", async e => {
      e.preventDefault();

      const password        = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      if (password !== confirmPassword) {
        msg.textContent = "Passwords do not match!";
        msg.style.color = "red";
        return;
      }

      try {
        const { data } = await axios.post("/reset-password", { password, confirmPassword });

        msg.textContent = data.message;
        msg.style.color = "green";

        if (data.success) {
          setTimeout(() => location.href = "/login", 1500);
        }
      } catch (err) {
        msg.textContent = err.response?.data?.message || "Server error";
        msg.style.color = "red";
      }
    });
  </script>
</body>
</html>